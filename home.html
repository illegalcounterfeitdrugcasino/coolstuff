<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tag Collector</title>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>Submitting Tag...</h2>

  <script>
    // Replace with your actual Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAIiWvA0EcLsGE0OdEQ6YHne5EDurUVAXU",
  authDomain: "codingprojects-ade75.firebaseapp.com",
  projectId: "codingprojects-ade75",
  storageBucket: "codingprojects-ade75.firebasestorage.app",
  messagingSenderId: "782742130363",
  appId: "1:782742130363:web:79e8dbc417c0d2aa3fe39e",
  measurementId: "G-DP2ZRVDTFT"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function main() {
      // Get tag ID from raw query string (everything after '?')
      const rawQuery = window.location.search; // like "?E0:04:01:08:50:82:07:65"
      const tagId = rawQuery.startsWith('?') ? rawQuery.slice(1) : null;

      if (!tagId || tagId.length < 8) {
        alert("Invalid or missing tag ID in URL.");
        return;
      }

      // Ask for the account key
      const accountKey = prompt("Enter your account key:");
      if (!accountKey) {
        alert("No account key provided.");
        return;
      }

      try {
        // Upload to Firestore
        await db.collection("tags").add({
          tagId: tagId,
          accountKey: accountKey,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        document.body.innerHTML = "<h2>Tag uploaded successfully!</h2>";
      } catch (err) {
        console.error("Upload error:", err);
        document.body.innerHTML = "<h2>Failed to upload tag.</h2>";
      }
    }

    main();
  </script>
</body>
</html>
