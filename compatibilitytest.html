<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FLGC Compatibility Inspector</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace;
      padding: 30px;
    }
    h1 { font-size: 28px; color: #00ffff; }
    pre {
      background: #111;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      white-space: pre-wrap;
      font-size: 14px;
    }
    .fail { color: red; }
    .pass { color: lime; }
    .warn { color: yellow; }
  </style>
</head>
<body>
  <h1>FLGC Compatibility Inspector</h1>
  <p>This tool checks every critical feature needed by FLGC and explains why a device might be incompatible.</p>
  <pre id="output">Running checks...</pre>

  <script>
    async function runDiagnostics() {
      const log = [];
      const failedReasons = [];

      const out = document.getElementById('output');
      const ua = navigator.userAgent;

      const isIOS = /iP(hone|od|ad)/.test(ua);
      const iosVersion = (() => {
        const match = ua.match(/OS (\d+)_?(\d+)?/);
        return match ? `${match[1]}.${match[2] || 0}` : "Unknown";
      })();

      const isCriOS = /CriOS\/([0-9.]+)/.exec(ua);
      const criosVersion = isCriOS ? isCriOS[1] : "N/A";

      const safariVersion = (() => {
        const match = ua.match(/Version\/([0-9.]+).*Safari/);
        return match ? match[1] : "Unknown";
      })();

      log.push(`User-Agent: ${ua}`);
      log.push(`iOS Version: ${iosVersion}`);
      log.push(`Safari Version: ${safariVersion}`);
      log.push(`Chrome (CriOS) Version: ${criosVersion}`);

      // 1. Module support
      let moduleSupport = false;
      try {
        new Function('import("")');
        moduleSupport = true;
        log.push(`✅ ES Modules: Supported`);
      } catch (e) {
        log.push(`❌ ES Modules: Not supported`);
        failedReasons.push("Missing ES module support");
      }

      // 2. Async/await
      let asyncSupported = true;
      try {
        new Function("async () => {}")();
        log.push(`✅ Async/Await: Supported`);
      } catch {
        asyncSupported = false;
        log.push(`❌ Async/Await: Not supported`);
        failedReasons.push("Missing async/await support");
      }

      // 3. WebGL
      let webglRenderer = "Unavailable";
      let webglOk = false;
      try {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        if (gl) {
          webglOk = true;
          const dbg = gl.getExtension("WEBGL_debug_renderer_info");
          webglRenderer = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : "Available (no debug info)";
        }
      } catch {}
      log.push(`${webglOk ? "✅" : "❌"} WebGL: ${webglOk ? "Supported" : "Not available"}`);
      log.push(`Renderer: ${webglRenderer}`);
      if (!webglOk) failedReasons.push("WebGL not supported");

      // 4. Firebase-related APIs
      if (!window.fetch) {
        log.push(`❌ fetch: Not supported`);
        failedReasons.push("Missing fetch API");
      } else {
        log.push(`✅ fetch: Supported`);
      }

      if (!window.Promise) {
        log.push(`❌ Promise: Not supported`);
        failedReasons.push("Missing Promise support");
      } else {
        log.push(`✅ Promise: Supported`);
      }

      if (!navigator.getBattery) {
        log.push(`⚠️ Battery API: Not available`);
      } else {
        log.push(`✅ Battery API: Available`);
      }

      if (!navigator.connection) {
        log.push(`⚠️ Connection API: Not available`);
      } else {
        log.push(`✅ Connection API: Available`);
      }

      // 5. Hardware
      log.push(`CPU Cores: ${navigator.hardwareConcurrency || "Unknown"}`);
      log.push(`Device Memory: ${navigator.deviceMemory || "Unknown"}`);
      log.push(`Touch Support: ${('ontouchstart' in window || navigator.maxTouchPoints > 0) ? "Yes" : "No"}`);
      log.push(`Screen: ${screen.width}x${screen.height} @${window.devicePixelRatio}x`);
      log.push(`Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}`);

      // Final verdict
      log.push(`\n=== COMPATIBILITY RESULT ===`);
      if (failedReasons.length === 0) {
        log.push(`✅ This device appears to be fully compatible with FLGC.`);
      } else {
        log.push(`❌ This device is NOT compatible with FLGC.`);
        log.push(`Reasons:`);
        failedReasons.forEach(r => log.push(`- ${r}`));
      }

      out.textContent = log.join('\n');
    }

    runDiagnostics();
  </script>
</body>
</html>
